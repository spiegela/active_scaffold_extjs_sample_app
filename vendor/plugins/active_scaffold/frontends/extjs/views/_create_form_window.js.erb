<% url_options = params_for(:action => :create, :commit => :create) -%>
try{
var  <%= controller_id %>_create_form = new Ext.FormPanel({
	name: '<%= controller_id %>_create_form',
	frame: 'true',
	labelWidth: 75,
	method: 'POST',
	border: false,
	bodyStyle: 'padding:5px;',
	defaultType: 'textfield',
	defaults:{anchor:'100%'},
	url: '<%= url_for(url_options) %>',
	baseParams: {
	  <%= request_forgery_protection_token %>: '<%= form_authenticity_token %>', format: 'json'
	},
	buttons: [
	  { text: 'Save',
	    handler: handleCreate(<%= controller_id %>_create_form.getForm()),
	    method:'POST'
	   },
	  { text: 'Cancel', 
	    handler: function(){ <%= controller_id %>_create_window.hide();}
	  }
	],
	items: [
      <%= render :partial => 'form.js.erb', :locals => {
	    :columns => active_scaffold_config.create.columns } %>
	]
});

var  <%= controller_id %>_create_window = new Ext.Window({
	title: "<%= active_scaffold_config.create.label %>",
	layout: 'fit',
	width: 500,
	height: 300,
	closeAction: 'hide',
	plain: 'true',
	items: [<%= controller_id %>_create_form]
});
} catch(e){
  alert(e);
}
<%= controller_id %>_create_window.add(<%= controller_id %>_create_form);
<%= controller_id %>_create_window.show();

function handleCreate(){
	form.submit( {
		reset: 'false',
		success: successfulCreate(),
		failure: failedCreate() }
}

function successfulCreate(){
	<%= controller_id %>_create_window.hide();
	document.<%= controller_id %>_grid.getStore().load(); 
}

function failedCreate(){
	Ext.MessageBox.alert('Status', 'Creation of <%= active_scaffold_config.model.name.humanize %> failed.');
}